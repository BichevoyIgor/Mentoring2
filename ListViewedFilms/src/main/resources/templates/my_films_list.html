<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Мои просмотренные фильмы</title>
</head>
<body>
<form th:action="@{/logout}" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    <h3><span th:text="${currentUsername}"></span></h3>
    <button type="submit" class="btn btn-link">Выйти</button>
</form>
<br>
<div>
    <a th:href="@{/profile}">Друзья</a>
</div>

<form th:action="@{/find-film-in-external-API}" method="get">
    <H3>Найти инфо о фильме на www.omdbapi.com</H3>
    <span>Название фильма: <input type="text" th:name="searchTitle"></span>
    <button type="submit" class="btn btn-link">Найти</button>
</form>
<br>

<H3 th:if="${not myCollection.isEmpty()}">Мои просмотренные фильмы</H3>

<form th:action="@{/films/add-film-form}" method="get">
    <button type="submit">Добавить фильм в библиотеку</button>
</form>

<form method="get" action="/films">
    <select name="genre">
        <option value="">Жанр</option>
        <option
                th:each="genre : ${genres}"
                th:value="${genre}"
                th:text="${genre}">
        </option>
    </select>

    <button type="submit">Фильтровать</button>
</form>

<div th:each="film : ${films.content}">
    <table border="1" bordercolor="white" cellpadding="10">
        <tbody>
        <tr>
            <td rowspan="7" width="300" height="400">
                <img th:src="${film.poster}" alt="poster" style="max-width: 100%; max-height: 100%; width: auto; height: auto"></td>
            <td>Название:</td>
            <td th:text="${film.title}"></td>
        </tr>
        <tr>
            <td>Год:</td>
            <td th:text="${film.year}"></td>
        </tr>
        <tr>
            <td>Жанр:</td>
            <td>
                <span th:if="${not film.genres.isEmpty()}">
                    <th:block th:each="genre,iter : ${film.genres}">
                        <a th:href="@{/films/genre/{genre_id}(genre_id=${genre.id})}"
                           th:text="${genre.title}">Жанр</a>
                        <span th:if="${not iter.last}">, </span>
                    </th:block>
                </span>
            </td>
        </tr>
        <tr>
            <td>Актеры:</td>
            <td>
                <span th:if="${not film.actors.isEmpty()}">
                    <th:block th:each="actor,iter : ${film.actors}">
                        <a th:href="@{https://ru.wikipedia.org/wiki/{actor_name}(actor_name=${actor.name})}"
                           th:text="${actor.name}" th:target="_blank">Актер</a>
                        <span th:if="${not iter.last}">, </span>
                    </th:block>
                </span>
            </td>
        </tr>
        <tr>
            <td>Рейтинг:</td>
            <td th:text="${film.rating}"></td>
        </tr>
        <tr>
            <td>Делюсь:</td>
            <td th:text="${film.share}"></td>
        </tr>
        <tr>
            <td>Описание:</td>
            <td th:text="${film.description}"></td>
        </tr>
        <tr>
            <td colspan="2">
                <div class="action-buttons">
                    <!-- Кнопка редактирования -->
                    <form th:action="@{/films/edit/{id}(id=${film.id})}" method="get">
                        <button type="submit" class="btn btn-edit">Редактировать</button>
                    </form>

                    <!-- Кнопка удаления -->
                    <form th:action="@{/films/delete/{id}(id=${film.id})}" method="post"
                          th:onclick="return confirm('Вы уверены, что хотите удалить этот фильм?')">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="btn btn-delete">Удалить</button>
                    </form>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div>
    <span th:if="${currentPage > 0}">
        <a th:href="@{/films(page=${currentPage -1})}"><< Назад</a>
    </span>

    <span>Страница <span th:text="${currentPage+1}"></span> из <span th:text="${totalPages}"></span></span>

    <span th:if="${currentPage+1 < totalPages}">
        <a th:href="@{/films(page=${currentPage + 1})}">Вперед >></a>
    </span>
</div>

</body>
</html>